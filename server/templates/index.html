<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Entorno de gestos 3D</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
        background-color: #000;
      }

      /* Cámara en vivo (arriba a la derecha) */
      #overlay {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 400px;
        height: 300px;
        border: 2px solid #00ffff;
        border-radius: 10px;
        overflow: hidden;
        z-index: 2;
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
      }

      #overlay img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
      }

      .label {
        position: absolute;
        top: 10px;
        right: 30px;
        color: #00ffff;
        font-size: 16px;
        font-weight: bold;
        text-shadow: 0 0 10px #00ffff;
        z-index: 3;
      }

      /* Texto HUD (fijo en pantalla) */
      #hud-text {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.6);
        color: #00ffff;
        border: 2px solid #00ffff;
        border-radius: 10px;
        padding: 10px 25px;
        font-size: 22px;
        font-weight: bold;
        text-shadow: 0 0 10px #00ffff;
        z-index: 3;
        font-family: monospace;
      }
    </style>
  </head>

  <body>
    <div class="label">Cámara en vivo</div>
    <div id="overlay">
      <img id="videoFeed" src="/video_feed" alt="Video en vivo" />
    </div>

    <!-- Texto siempre visible (HUD) -->
    <div id="hud-text">Detectando gestos...</div>

    <!-- Escenario A-Frame -->
    <a-scene>
      <a-entity light="type: ambient; intensity: 0.7"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="2 4 -3"></a-entity>

      <a-plane position="0 0 -4" rotation="-90 0 0" width="20" height="20" color="#101010" shadow></a-plane>

      <a-box
        id="cubo"
        position="0 1.5 -3"
        rotation="0 45 0"
        color="#00ffff"
        shadow
        animation="property: rotation; to: 0 405 0; loop: true; dur: 4000"
      ></a-box>

      <a-entity position="0 1.6 0">
        <a-camera></a-camera>
      </a-entity>
    </a-scene>

    <script>
      const hudText = document.getElementById("hud-text");
      let ultimoGesto = "";

      async function actualizarGesto() {
        try {
          const res = await fetch("/ultimo_gesto");
          const data = await res.json();
          const gesto = data.gesto;

          if (gesto && gesto !== ultimoGesto) {
            ultimoGesto = gesto;
            hudText.textContent = `Gesto: ${gesto}`;

            // Voz al cambiar gesto
            const utter = new SpeechSynthesisUtterance(gesto);
            utter.lang = "es-ES";
            utter.rate = 1.1;
            speechSynthesis.speak(utter);
          }
        } catch (e) {
          console.error("Error obteniendo gesto:", e);
        }
      }

      setInterval(actualizarGesto, 700);
    </script>
  </body>
</html>
