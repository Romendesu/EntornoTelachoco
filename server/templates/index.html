<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Te-La-Choco Videojuego</title>

  <!-- Estilos cr√≠ticos inline -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap');
    
    body { 
      margin: 0; 
      background: #353535; 
      color: #fff; 
      font-family: 'Quicksand', system-ui, sans-serif;
      overflow: hidden;
    }
    
    /* Escena A-Frame */
    a-scene {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 1 !important;
    }

    /* HUD principal */
    #hud {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    #hud div {
      background: rgba(25,25,25,0.85);
      border: 2px solid #4f4f4f;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      backdrop-filter: blur(8px);
      transform-origin: left center;
      animation: hudEntrada 0.3s ease-out;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    #hud-score {
      color: #00ff9d;
      font-size: 1.2em;
    }

    #hud-lives {
      color: #ff6b6b;
    }

    #hud-combo {
      color: #66d9ff;
      font-size: 0.9em;
      transition: transform 0.2s ease, color 0.3s ease;
      position: relative;
    }
    
    #hud-combo.active {
      transform: scale(1.2);
      color: #ff6b6b;
      animation: comboFlash 0.5s ease-out;
    }

    @keyframes comboFlash {
      0% { transform: scale(1); color: #66d9ff; }
      50% { transform: scale(1.3); color: #ff6b6b; }
      100% { transform: scale(1.2); color: #ff9f43; }
    }

    /* Tarjeta moderna para el gesto del minicubo */
    #mini-gesture-card {
      position: absolute;
      left: 50%;
      bottom: 28px;
      transform: translateX(-50%);
      z-index: 1000;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.12));
      color: #fff;
      padding: 12px 18px;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      display: flex;
      gap: 12px;
      align-items: center;
      min-width: 220px;
      backdrop-filter: blur(6px) saturate(120%);
      font-weight: 700;
      font-size: 18px;
      opacity: 0.95;
    }
    #mini-gesture-card .icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: #102210;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9fe39f;
      font-size: 20px;
      box-shadow: inset 0 -6px 12px rgba(0,0,0,0.2);
    }
    #mini-gesture-card .text {
      flex: 1;
      text-align: left;
      font-size: 18px;
      color: #e6ffe6;
    }
    #mini-gesture-card.hidden { display: none; }

    /* Feed de c√°mara */
    #camera-ui {
      position: absolute;
      top: 20px;
      right: 20px;
      text-align: center;
      background: rgba(25,25,25,0.85);
      padding: 12px;
      border-radius: 16px;
      border: 2px solid #4f4f4f;
      z-index: 999;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      animation: cameraEntrada 0.4s ease-out;
    }

    #camera-ui .label {
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    #camera-ui img {
      width: 220px;
      height: 165px;
      border-radius: 12px;
      border: 2px solid #4f4f4f;
      object-fit: contain;
      background: #111;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    #gesto-actual {
      margin-top: 10px;
      color: #66d9ff;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(102,217,255,0.5);
      animation: gestoEntrada 0.3s ease-out;
    }

    /* Game Over Menu */
    #game-over-menu {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.85);
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
      z-index: 9999;
      backdrop-filter: blur(10px);
      border: 3px solid #ff6b6b;
      box-shadow: 0 0 30px rgba(255,0,0,0.2);
      animation: gameOverEntrada 0.5s ease-out;
    }

      .game-over-image {
        width: 200px;
        height: 200px;
        object-fit: contain;
        margin-bottom: 1rem;
        animation: pulseImage 2s infinite ease-in-out;
      }

      @keyframes pulseImage {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }

    #game-over-menu h2 {
      color: #ff6b6b;
      font-size: 2.5rem;
      margin: 0 0 1rem 0;
      text-shadow: 0 0 10px rgba(255,107,107,0.5);
    }

    #game-over-menu .score {
      color: #00ff9d;
      font-size: 1.5rem;
      margin: 1rem 0;
      text-shadow: 0 0 10px rgba(0,255,157,0.5);
    }

    #game-over-menu .buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    #game-over-menu button {
      background: transparent;
      color: white;
      border: 2px solid white;
      padding: 0.8rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      font-weight: bold;
    }

    #game-over-menu button:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    @keyframes gameOverEntrada {
      from { 
        transform: translate(-50%, -40%); 
        opacity: 0;
      }
      to { 
        transform: translate(-50%, -50%); 
        opacity: 1;
      }
    }

    /* Overlay oscuro para game over */
    #game-over-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 9998;
      backdrop-filter: blur(3px);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Animaciones */
    @keyframes hudEntrada {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes cameraEntrada {
      from { transform: translateX(20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes gestoEntrada {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* Mensaje de combo */
    .combo-popup {
      position: fixed;
      left: 50%;
      top: 40%;
      transform: translate(-50%, -50%);
      background: rgba(255, 165, 0, 0.25);
      color: #ffd700;
      padding: 15px 25px;
      border-radius: 20px;
      font-size: 32px;
      font-weight: 700;
      pointer-events: none;
      animation: comboPopup 1.2s ease-out forwards;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
      backdrop-filter: blur(4px);
      border: 2px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.4);
    }

    @keyframes comboPopup {
      0% { transform: translate(-50%, -30%) scale(0.8); opacity: 0; }
      20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -70%) scale(0.9); opacity: 0; }
    }
  </style>

    <!-- A-Frame desde CDN -->
    <!-- Sistema de Audio (lazy) -->
    <audio id="sound-kill" src="{{ url_for('static', filename='sounds/kill_sound.mp3') }}" preload="none"></audio>
    <audio id="sound-death" src="{{ url_for('static', filename='sounds/death_sound.mp3') }}" preload="none"></audio>
    <audio id="sound-gameover" src="{{ url_for('static', filename='sounds/game_over.mp3') }}" preload="none"></audio>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>

<body>
  <!-- C√°mara UI -->
  <div id="camera-ui">
    <div class="label">üì∑ C√°mara de Gestos</div>
    <img id="videoFeed" alt="Video en vivo">
    <div id="gesto-actual">üëã Realiza un gesto...</div>
  </div>

  <!-- HUD usuario -->
  <div id="hud">
    <div id="hud-score">üéØ Puntuaci√≥n: 0</div>
    <div id="hud-lives">‚ù§Ô∏è Vidas: 3</div>
    <div id="hud-combo">üî• Combo: x1</div>
  </div>

  <!-- Tarjeta moderna para el gesto objetivo de minicubos -->
  <div id="mini-gesture-card" class="hidden" aria-live="polite">
    <div class="icon">ü§ö</div>
    <div class="text" id="mini-gesture-text">‚Äî</div>
  </div>

  <!-- Escena 3D -->
  <a-scene id="scene" embedded renderer="antialias: true; colorManagement: true;">
    <a-assets id="assets">
      <!-- Solo mantenemos el modelo del enemigo -->
      <a-asset-item id="butter-robot" src="/static/sprites/assets/Butter Robot.glb"></a-asset-item>
    </a-assets>

    <!-- Iluminaci√≥n mejorada -->
    <a-entity light="type: ambient; color: #FFE8D6; intensity: 0.5"></a-entity>
    <a-entity light="type: directional; color: #FFB830; intensity: 1.4; castShadow: true" position="-1 4 1"></a-entity>
    <a-entity light="type: hemisphere; color: #87CEEB; groundColor: #47624F; intensity: 0.7"></a-entity>
    <a-entity light="type: spot; color: #FFD700; intensity: 0.4; angle: 45" position="0 5 0"></a-entity>

    <!-- Cielo din√°mico -->
    <a-sky color="#6BB7E8">
        <a-animation attribute="color" from="#6BB7E8" to="#87CEEB" dur="10000" direction="alternate" repeat="indefinite"></a-animation>
    </a-sky>
    
    <!-- Suelo base -->
    <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100" 
            material="shader: standard; color: #7CB342; roughness: 0.9; metalness: 0.1; repeat: 100 100">
    </a-plane>

    <!-- Decoraciones del entorno Low Poly -->
    <a-entity id="environment-decorations">
        <!-- √Årboles Low Poly -->
        <a-entity class="low-poly-tree" position="-25 0 -20">
            <!-- Tronco -->
            <a-cylinder color="#8D6E63" height="3" radius="0.3" segments-radial="6"
                       material="roughness: 0.9; metalness: 0.1"></a-cylinder>
            <!-- Copa -->
            <a-cone color="#2E7D32" height="4" radius-bottom="2" radius-top="0" segments-radial="6"
                   position="0 3.5 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
        </a-entity>

        <a-entity class="low-poly-tree" position="-15 0 -25">
            <a-cylinder color="#8D6E63" height="2.5" radius="0.25" segments-radial="6"
                       material="roughness: 0.9; metalness: 0.1"></a-cylinder>
            <a-cone color="#388E3C" height="3.5" radius-bottom="1.8" radius-top="0" segments-radial="6"
                   position="0 3 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
        </a-entity>

        <a-entity class="low-poly-tree" position="20 0 -15">
            <a-cylinder color="#8D6E63" height="3.2" radius="0.35" segments-radial="6"
                       material="roughness: 0.9; metalness: 0.1"></a-cylinder>
            <a-cone color="#1B5E20" height="4.2" radius-bottom="2.2" radius-top="0" segments-radial="6"
                   position="0 3.7 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
        </a-entity>

        <!-- Monta√±as Low Poly -->
        <a-entity class="low-poly-mountain" position="-30 0 -35">
            <a-cone color="#757575" height="12" radius-bottom="8" radius-top="0" segments-radial="5"
                   material="roughness: 0.95; metalness: 0.05"></a-cone>
            <!-- Nieve en la cima -->
            <a-cone color="#EEEEEE" height="3" radius-bottom="2.5" radius-top="0" segments-radial="5"
                   position="0 9 0" material="roughness: 0.8; metalness: 0.2"></a-cone>
        </a-entity>

        <a-entity class="low-poly-mountain" position="35 0 -40">
            <a-cone color="#616161" height="15" radius-bottom="10" radius-top="0" segments-radial="5"
                   material="roughness: 0.95; metalness: 0.05"></a-cone>
            <a-cone color="#FAFAFA" height="4" radius-bottom="3" radius-top="0" segments-radial="5"
                   position="0 11 0" material="roughness: 0.8; metalness: 0.2"></a-cone>
        </a-entity>

        <!-- √Årboles adicionales -->
        <a-entity class="low-poly-tree" position="-40 0 -15">
            <a-cylinder color="#8D6E63" height="2.8" radius="0.3" segments-radial="6"
                       material="roughness: 0.9; metalness: 0.1"></a-cylinder>
            <a-cone color="#388E3C" height="3.8" radius-bottom="1.9" radius-top="0" segments-radial="6"
                   position="0 3.3 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
        </a-entity>

        <a-entity class="low-poly-tree" position="30 0 -25">
            <a-cylinder color="#8D6E63" height="3" radius="0.28" segments-radial="6"
                       material="roughness: 0.9; metalness: 0.1"></a-cylinder>
            <a-cone color="#2E7D32" height="4" radius-bottom="2" radius-top="0" segments-radial="6"
                   position="0 3.5 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
        </a-entity>

        <!-- Monta√±as adicionales -->
        <a-entity class="low-poly-mountain" position="0 0 -45">
            <a-cone color="#616161" height="18" radius-bottom="12" radius-top="0" segments-radial="5"
                   material="roughness: 0.95; metalness: 0.05"></a-cone>
            <a-cone color="#FAFAFA" height="5" radius-bottom="3.5" radius-top="0" segments-radial="5"
                   position="0 13 0" material="roughness: 0.8; metalness: 0.2"></a-cone>
        </a-entity>

        <!-- Script para generar elementos aleatorios -->
        <script>
            function randomRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const scene = document.querySelector('a-scene');
            const safeZone = {
                minX: -45,
                maxX: 45,
                minZ: -45,
                maxZ: -10
            };

            // Generar 10 √°rboles adicionales
            for (let i = 0; i < 10; i++) {
                const tree = document.createElement('a-entity');
                const x = randomRange(safeZone.minX, safeZone.maxX);
                const z = randomRange(safeZone.minZ, safeZone.maxZ);
                tree.innerHTML = `
                    <a-cylinder color="#8D6E63" height="${randomRange(2, 3.5)}" radius="${randomRange(0.25, 0.35)}" segments-radial="6"
                               material="roughness: 0.9; metalness: 0.1"></a-cylinder>
                    <a-cone color="#${['2E7D32', '388E3C', '1B5E20'][Math.floor(Math.random() * 3)]}" 
                           height="${randomRange(3, 4.5)}" radius-bottom="${randomRange(1.8, 2.3)}" radius-top="0" segments-radial="6"
                           position="0 ${randomRange(3, 4)} 0" material="roughness: 0.8; metalness: 0.1"></a-cone>
                `;
                tree.setAttribute('position', `${x} 0 ${z}`);
                tree.setAttribute('rotation', `0 ${randomRange(0, 360)} 0`);
                scene.appendChild(tree);
            }

            // Generar 10 monta√±as adicionales
            for (let i = 0; i < 10; i++) {
                const mountain = document.createElement('a-entity');
                const x = randomRange(safeZone.minX, safeZone.maxX);
                const z = randomRange(safeZone.minZ, safeZone.maxZ);
                const height = randomRange(10, 20);
                mountain.innerHTML = `
                    <a-cone color="#${['757575', '616161', '424242'][Math.floor(Math.random() * 3)]}" 
                           height="${height}" radius-bottom="${randomRange(6, 12)}" radius-top="0" segments-radial="5"
                           material="roughness: 0.95; metalness: 0.05"></a-cone>
                    <a-cone color="#FAFAFA" height="${height * 0.25}" radius-bottom="${randomRange(2, 4)}" radius-top="0" segments-radial="5"
                           position="0 ${height * 0.75} 0" material="roughness: 0.8; metalness: 0.2"></a-cone>
                `;
                mountain.setAttribute('position', `${x} 0 ${z}`);
                mountain.setAttribute('rotation', `0 ${randomRange(0, 360)} 0`);
                scene.appendChild(mountain);
            }

            // Generar decoraciones en el fondo (vista inicial del usuario)
            const backDecorations = [
                // Cristales flotantes
                {
                    type: 'crystal',
                    count: 5,
                    create: () => {
                        const crystal = document.createElement('a-entity');
                        const height = randomRange(3, 6);
                        const color = ['#B3E5FC', '#81D4FA', '#4FC3F7'][Math.floor(Math.random() * 3)];
                        crystal.innerHTML = `
                            <a-cone color="${color}" height="${height}" radius-bottom="${randomRange(0.8, 1.5)}" 
                                   radius-top="0.1" segments-radial="6" material="roughness: 0.2; metalness: 0.8">
                                <a-animation attribute="rotation" from="0 0 0" to="0 360 0" 
                                           dur="${randomRange(20000, 30000)}" repeat="indefinite" easing="linear">
                                </a-animation>
                            </a-cone>
                        `;
                        return crystal;
                    }
                },
                // Rocas low poly
                {
                    type: 'rock',
                    count: 8,
                    create: () => {
                        const rock = document.createElement('a-entity');
                        const scale = randomRange(0.5, 2);
                        const color = ['#616161', '#757575', '#9E9E9E'][Math.floor(Math.random() * 3)];
                        rock.innerHTML = `
                            <a-dodecahedron color="${color}" radius="${scale}"
                                          material="roughness: 0.9; metalness: 0.1"
                                          animation="property: rotation; to: 0 360 0; loop: true; dur: ${randomRange(30000, 40000)}">
                            </a-dodecahedron>
                        `;
                        return rock;
                    }
                },
                // Flores low poly
                {
                    type: 'flower',
                    count: 12,
                    create: () => {
                        const flower = document.createElement('a-entity');
                        const height = randomRange(0.3, 0.8);
                        const color = ['#E91E63', '#F06292', '#FF4081'][Math.floor(Math.random() * 3)];
                        flower.innerHTML = `
                            <a-cylinder color="#4CAF50" height="${height}" radius="0.05" segments-radial="4"
                                      material="roughness: 0.8; metalness: 0.1"></a-cylinder>
                            <a-cone color="${color}" height="0.2" radius-bottom="0.2" radius-top="0" segments-radial="4"
                                   position="0 ${height + 0.1} 0" material="roughness: 0.7; metalness: 0.2">
                                <a-animation attribute="rotation" from="0 0 0" to="0 360 0" 
                                           dur="5000" repeat="indefinite" easing="linear"></a-animation>
                            </a-cone>
                        `;
                        return flower;
                    }
                }
            ];

            // Zona espec√≠fica para decoraciones del fondo
            const backZone = {
                minX: -50,
                maxX: 50,
                minZ: -60,
                maxZ: -40
            };

            // Generar cada tipo de decoraci√≥n
            backDecorations.forEach(decoration => {
                for (let i = 0; i < decoration.count; i++) {
                    const element = decoration.create();
                    const x = randomRange(backZone.minX, backZone.maxX);
                    const z = randomRange(backZone.minZ, backZone.maxZ);
                    const y = decoration.type === 'crystal' ? randomRange(2, 8) : 0;
                    element.setAttribute('position', `${x} ${y} ${z}`);
                    element.setAttribute('rotation', `0 ${randomRange(0, 360)} 0`);
                    scene.appendChild(element);
                }
            });
        </script>
    </a-entity>

    <!-- L√≠nea roja de p√©rdida de vida -->
    <a-entity id="death-line" position="0 0.1 2">
      <a-box width="30" height="0.1" depth="0.1" 
             material="shader: standard; color: #FF0000; emissive: #FF0000; emissiveIntensity: 0.5; transparent: true; opacity: 0.7">
      </a-box>
      <!-- Efecto de brillo para la l√≠nea -->
      <a-plane width="30" height="0.3" rotation="-90 0 0"
               material="shader: flat; color: #FF0000; transparent: true; opacity: 0.2"
               animation="property: scale; from: 1 1 1; to: 1.2 1 1.2; dir: alternate; dur: 1000; loop: true">
      </a-plane>
    </a-entity>


    <!-- Sistema de nubes din√°micas mejorado y expandido -->
    <a-entity id="cloud-system">
        <!-- Capa superior de nubes -->
        <a-entity position="0 50 -50">
            <a-entity gltf-model="#clouds" scale="4.5 4.5 4.5" rotation="0 0 0">
                <a-animation attribute="position" from="-120 0 0" to="120 0 0" dur="150000" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <!-- Capa media de nubes -->
        <a-entity position="0 40 -40">
            <a-entity gltf-model="#clouds" scale="3.5 3.5 3.5" rotation="0 45 0">
                <a-animation attribute="position" from="-100 0 0" to="100 0 0" dur="180000" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <!-- Nubes bajas y cercanas -->
        <a-entity position="0 25 -30">
            <a-entity gltf-model="#clouds" scale="2.5 2.5 2.5" rotation="0 180 0">
                <a-animation attribute="position" from="-90 0 0" to="90 0 0" dur="160000" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <!-- Nubes decorativas laterales -->
        <a-entity position="-40 30 -35">
            <a-entity gltf-model="#clouds" scale="2 2 2" rotation="0 30 0">
                <a-animation attribute="position" from="0 0 0" to="0 2 0" dur="8000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="40 28 -35">
            <a-entity gltf-model="#clouds" scale="1.8 1.8 1.8" rotation="0 -30 0">
                <a-animation attribute="position" from="0 0 0" to="0 2 0" dur="9000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
    </a-entity>

        <!-- Rocas grandes en puntos de spawn de enemigos -->
    <!-- Roca spawn izquierda -->
    <a-entity position="-15 2 -15">
        <a-entity gltf-model="#rocks-model" scale="4 4 4" rotation="0 45 0">
            <a-animation attribute="rotation" from="0 45 0" to="0 405 0" dur="30000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
    </a-entity>

    <!-- Roca spawn central -->
    <a-entity position="0 2 -15">
        <a-entity gltf-model="#rocks-var1" scale="4 4 4" rotation="0 180 0">
            <a-animation attribute="rotation" from="0 180 0" to="0 540 0" dur="30000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
    </a-entity>

    <!-- Roca spawn derecha -->
    <a-entity position="15 2 -15">
        <a-entity gltf-model="#rocks-model" scale="4 4 4" rotation="0 270 0">
            <a-animation attribute="rotation" from="0 270 0" to="0 630 0" dur="30000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
    </a-entity>

    <!-- Formaciones rocosas adicionales -->
    <a-entity id="additional-rocks">
        <!-- Cluster izquierdo -->
        <a-entity position="-35 0.5 -15">
            <a-entity gltf-model="#rocks-var1" scale="3 3 3" rotation="0 120 0"></a-entity>
        </a-entity>
        <a-entity position="-40 0.5 -20">
            <a-entity gltf-model="#rocks-model" scale="2.5 2.5 2.5" rotation="0 45 0"></a-entity>
        </a-entity>
        
        <!-- Cluster derecho -->
        <a-entity position="35 0.5 -15">
            <a-entity gltf-model="#rocks-model" scale="3 3 3" rotation="0 -120 0"></a-entity>
        </a-entity>
        <a-entity position="40 0.5 -20">
            <a-entity gltf-model="#rocks-var1" scale="2.5 2.5 2.5" rotation="0 -45 0"></a-entity>
        </a-entity>
        
        <!-- Rocas dispersas -->
        <a-entity position="-25 0.5 -25">
            <a-entity gltf-model="#rock-single" scale="2 2 2" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity position="25 0.5 -25">
            <a-entity gltf-model="#rock-single" scale="2 2 2" rotation="0 -90 0"></a-entity>
        </a-entity>
    </a-entity>

    <!-- Monta√±as de fondo para profundidad -->
    <a-entity id="mountain-range-background">
        <a-entity position="-40 0 -45">
            <a-entity gltf-model="#rocks-model" scale="12 15 8" rotation="0 20 0">
                <a-animation attribute="rotation" from="0 20 0" to="0 22 0" dur="40000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="40 0 -45">
            <a-entity gltf-model="#rocks-var1" scale="11 14 8" rotation="0 -20 0">
                <a-animation attribute="rotation" from="0 -20 0" to="0 -22 0" dur="42000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="0 0 -50">
            <a-entity gltf-model="#rocks-model" scale="14 16 8" rotation="0 0 0">
                <a-animation attribute="rotation" from="0 0 0" to="0 2 0" dur="45000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
    </a-entity>

    <!-- Detalles rocosos entre monta√±as -->
    <a-entity id="mountain-details">
        <!-- Izquierda -->
        <a-entity position="-25 0 -35">
            <a-entity gltf-model="#rock-single" scale="3 4 2" rotation="0 45 0"></a-entity>
        </a-entity>
        <!-- Centro -->
        <a-entity position="0 0 -35">
            <a-entity gltf-model="#rock-single" scale="3.5 4.5 2" rotation="0 0 0"></a-entity>
        </a-entity>
        <!-- Derecha -->
        <a-entity position="25 0 -35">
            <a-entity gltf-model="#rock-single" scale="3 4 2" rotation="0 -45 0"></a-entity>
        </a-entity>
    </a-entity>

    <!-- Sistema forestal expandido -->
    <!-- Bosque denso principal m√°s cercano -->
    <a-entity id="forest-main">
        <!-- √Årboles gigantes en primer plano -->
        <a-entity position="-20 2 0">
            <a-entity gltf-model="#tree-model" scale="3.5 4 3.5" rotation="0 20 0">
                <a-animation attribute="rotation" from="0 20 0" to="0 22 1" dur="4000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="20 2 0">
            <a-entity gltf-model="#tree-var1" scale="3.2 3.8 3.2" rotation="0 -15 0">
                <a-animation attribute="rotation" from="0 -15 0" to="0 -17 1" dur="4500" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- √Årboles peque√±os en primer plano -->
        <a-entity position="-28 2 3">
            <a-entity gltf-model="#tree-model" scale="2.8 3.2 2.8" rotation="0 45 0">
                <a-animation attribute="rotation" from="0 45 0" to="0 47 1" dur="4200" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="28 2 3">
            <a-entity gltf-model="#tree-var1" scale="2.6 3 2.6" rotation="0 -45 0">
                <a-animation attribute="rotation" from="0 -45 0" to="0 -47 1" dur="4300" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- Grupos de √°rboles medianos cercanos -->
        <a-entity position="-10 0.5 -20">
            <a-entity gltf-model="#tree-model" scale="2.8 3.2 2.8" rotation="0 45 0">
                <a-animation attribute="rotation" from="0 45 0" to="0 47 1" dur="5000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="15 0.5 -18">
            <a-entity gltf-model="#tree-var1" scale="2.6 3 2.6" rotation="0 -30 0">
                <a-animation attribute="rotation" from="0 -30 0" to="0 -32 1" dur="4800" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- √Årboles de fondo cercanos -->
        <a-entity position="-25 0 -25">
            <a-entity gltf-model="#tree-model" scale="3 3.5 3" rotation="0 60 0">
                <a-animation attribute="rotation" from="0 60 0" to="0 62 1" dur="5200" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="25 0 -25">
            <a-entity gltf-model="#tree-var1" scale="2.8 3.3 2.8" rotation="0 -75 0">
                <a-animation attribute="rotation" from="0 -75 0" to="0 -77 1" dur="5500" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
    </a-entity>

    <!-- Bosques laterales expandidos -->
    <a-entity id="forest-sides">
        <!-- Grupo izquierdo -->
        <a-entity position="-35 0 -20">
            <a-entity gltf-model="#tree-var1" scale="2.4 2.8 2.4" rotation="0 85 0">
                <a-animation attribute="rotation" from="0 85 0" to="0 87 1" dur="5000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="-32 0 -23">
            <a-entity gltf-model="#tree-model" scale="2.2 2.6 2.2" rotation="0 -45 0">
                <a-animation attribute="rotation" from="0 -45 0" to="0 -47 1" dur="4800" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="-38 0 -25">
            <a-entity gltf-model="#tree-var1" scale="2.5 2.9 2.5" rotation="0 120 0">
                <a-animation attribute="rotation" from="0 120 0" to="0 122 1" dur="5200" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- Grupo derecho -->
        <a-entity position="35 0 -20">
            <a-entity gltf-model="#tree-model" scale="2.3 2.7 2.3" rotation="0 -60 0">
                <a-animation attribute="rotation" from="0 -60 0" to="0 -62 1" dur="5000" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="32 0 -23">
            <a-entity gltf-model="#tree-var1" scale="2.6 3 2.6" rotation="0 30 0">
                <a-animation attribute="rotation" from="0 30 0" to="0 32 1" dur="5300" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="38 0 -25">
            <a-entity gltf-model="#tree-model" scale="2.4 2.8 2.4" rotation="0 -90 0">
                <a-animation attribute="rotation" from="0 -90 0" to="0 -92 1" dur="5100" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>

        <!-- Grupo central de fondo -->
        <a-entity position="0 0 -30">
            <a-entity gltf-model="#tree-var1" scale="2.7 3.1 2.7" rotation="0 0 0">
                <a-animation attribute="rotation" from="0 0 0" to="0 2 1" dur="5400" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="-5 0 -32">
            <a-entity gltf-model="#tree-model" scale="2.5 2.9 2.5" rotation="0 45 0">
                <a-animation attribute="rotation" from="0 45 0" to="0 47 1" dur="5600" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="5 0 -32">
            <a-entity gltf-model="#tree-var1" scale="2.6 3 2.6" rotation="0 -45 0">
                <a-animation attribute="rotation" from="0 -45 0" to="0 -47 1" dur="5200" direction="alternate" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
    </a-entity>

    <!-- Sistema de decoraci√≥n del terreno expandido -->
    <a-entity id="terrain-details">
        <!-- Formaciones rocosas principales cercanas -->
        <a-entity position="-12 0.5 -15">
            <a-entity gltf-model="#rocks-var1" scale="2.2 2.2 2.2" rotation="0 120 0"></a-entity>
        </a-entity>
        <a-entity position="12 0.5 -15">
            <a-entity gltf-model="#rocks-model" scale="1.8 1.8 1.8" rotation="0 45 0"></a-entity>
        </a-entity>
        
        <!-- Rocas individuales cercanas -->
        <a-entity position="-18 0.5 -12">
            <a-entity gltf-model="#rock-single" scale="1.6 1.6 1.6" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity position="18 0.5 -12">
            <a-entity gltf-model="#rock-single" scale="1.4 1.4 1.4" rotation="0 180 0"></a-entity>
        </a-entity>

        <!-- Nuevas formaciones rocosas dispersas -->
        <a-entity position="-45 0.5 -25">
            <a-entity gltf-model="#rocks-model" scale="2.5 2.5 2.5" rotation="0 160 0"></a-entity>
        </a-entity>
        <a-entity position="45 0.5 -25">
            <a-entity gltf-model="#rocks-var1" scale="2.3 2.3 2.3" rotation="0 -160 0"></a-entity>
        </a-entity>
        <a-entity position="-30 0.5 -18">
            <a-entity gltf-model="#rock-single" scale="1.8 1.8 1.8" rotation="0 75 0"></a-entity>
        </a-entity>
        <a-entity position="30 0.5 -18">
            <a-entity gltf-model="#rock-single" scale="1.7 1.7 1.7" rotation="0 -75 0"></a-entity>
        </a-entity>
        
        <!-- Rocas decorativas laterales -->
        <a-entity position="-25 0 -18">
            <a-entity gltf-model="#rocks-var1" scale="1.5 1.5 1.5" rotation="0 270 0"></a-entity>
        </a-entity>
        <a-entity position="25 0 -18">
            <a-entity gltf-model="#rocks-model" scale="1.6 1.6 1.6" rotation="0 60 0"></a-entity>
        </a-entity>
        
        <!-- Campos de hierba grandes cercanos -->
        <a-entity position="-15 0 -20">
            <a-entity gltf-model="#grass-model" scale="2 2 2" rotation="0 0 0">
                <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="5000" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        <a-entity position="15 0 -20">
            <a-entity gltf-model="#grass-model" scale="1.8 1.8 1.8" rotation="0 45 0">
                <a-animation attribute="rotation" from="0 45 0" to="0 405 0" dur="6000" repeat="indefinite"></a-animation>
            </a-entity>
        </a-entity>
        
        <!-- Grupos de hierba dispersos cercanos -->
        <a-entity id="grass-clusters-close">
            <a-entity position="-8 0 -15">
                <a-entity gltf-model="#grass-model" scale="1.4 1.4 1.4" rotation="0 90 0">
                    <a-animation attribute="rotation" from="0 90 0" to="0 450 0" dur="5500" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
            <a-entity position="8 0 -15">
                <a-entity gltf-model="#grass-model" scale="1.6 1.6 1.6" rotation="0 180 0">
                    <a-animation attribute="rotation" from="0 180 0" to="0 540 0" dur="5800" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- Grupos de hierba laterales -->
        <a-entity id="grass-clusters-sides">
            <a-entity position="-20 0 -25">
                <a-entity gltf-model="#grass-model" scale="1.5 1.5 1.5" rotation="0 270 0">
                    <a-animation attribute="rotation" from="0 270 0" to="0 630 0" dur="5200" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
            <a-entity position="20 0 -25">
                <a-entity gltf-model="#grass-model" scale="1.7 1.7 1.7" rotation="0 0 0">
                    <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="5400" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- Grupos de hierba de fondo -->
        <a-entity id="grass-clusters-back">
            <a-entity position="-25 0 -30">
                <a-entity gltf-model="#grass-model" scale="1.8 1.8 1.8" rotation="0 45 0">
                    <a-animation attribute="rotation" from="0 45 0" to="0 405 0" dur="5600" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
            <a-entity position="25 0 -30">
                <a-entity gltf-model="#grass-model" scale="1.6 1.6 1.6" rotation="0 135 0">
                    <a-animation attribute="rotation" from="0 135 0" to="0 495 0" dur="5300" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
            <a-entity position="0 0 -35">
                <a-entity gltf-model="#grass-model" scale="2 2 2" rotation="0 90 0">
                    <a-animation attribute="rotation" from="0 90 0" to="0 450 0" dur="5700" repeat="indefinite"></a-animation>
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- Rocas peque√±as decorativas adicionales -->
        <a-entity id="small-rocks-decoration">
            <a-entity position="-15 0 -28">
                <a-entity gltf-model="#rock-single" scale="1.2 1.2 1.2" rotation="0 30 0"></a-entity>
            </a-entity>
            <a-entity position="15 0 -28">
                <a-entity gltf-model="#rock-single" scale="1.3 1.3 1.3" rotation="0 150 0"></a-entity>
            </a-entity>
            <a-entity position="-10 0 -25">
                <a-entity gltf-model="#rock-single" scale="1.1 1.1 1.1" rotation="0 210 0"></a-entity>
            </a-entity>
            <a-entity position="10 0 -25">
                <a-entity gltf-model="#rock-single" scale="1.2 1.2 1.2" rotation="0 300 0"></a-entity>
            </a-entity>
        </a-entity>
      <a-entity gltf-model="#rock-single" scale="1.5 1.5 1.5" rotation="0 -60 0"></a-entity>
    </a-entity>
    <a-entity position="45 0 -38">
      <a-entity gltf-model="#rocks-model" scale="0.9 0.9 0.9" rotation="0 180 0"></a-entity>
    </a-entity>

    <!-- Parches de hierba -->
    <a-entity position="0 2 -15">
      <a-entity gltf-model="#grass-model" scale="1.5 1.5 1.5"></a-entity>
    </a-entity>
    <a-entity position="-15 2 -13">
      <a-entity gltf-model="#grass-model" scale="1.2 1.2 1.2" rotation="0 45 0"></a-entity>
    </a-entity>
    <a-entity position="18 2 -17">
      <a-entity gltf-model="#grass-model" scale="1.3 1.3 1.3" rotation="0 -30 0"></a-entity>
    </a-entity>
    
    <!-- Nuevos parches de hierba adicionales -->
    <a-entity position="-35 0.2 -20">
      <a-entity gltf-model="#grass-model" scale="1.4 1.4 1.4" rotation="0 90 0"></a-entity>
    </a-entity>
    <a-entity position="35 0.2 -20">
      <a-entity gltf-model="#grass-model" scale="1.4 1.4 1.4" rotation="0 -90 0"></a-entity>
    </a-entity>
    <a-entity position="-25 0.2 -35">
      <a-entity gltf-model="#grass-model" scale="1.3 1.3 1.3" rotation="0 180 0"></a-entity>
    </a-entity>
    <a-entity position="25 0.2 -35">
      <a-entity gltf-model="#grass-model" scale="1.3 1.3 1.3" rotation="0 0 0"></a-entity>
    </a-entity>

    <!-- Sistema de nubes -->
    <a-entity position="-20 18 -25">
      <a-entity gltf-model="#clouds" scale="3 3 3" rotation="0 10 0"></a-entity>
    </a-entity>
    <a-entity position="18 20 -28">
      <a-entity gltf-model="#clouds" scale="2.6 2.6 2.6" rotation="0 -10 0"></a-entity>
    </a-entity>
    <a-entity position="0 22 -35">
      <a-entity gltf-model="#clouds" scale="2.8 2.8 2.8" rotation="0 180 0"></a-entity>
    </a-entity>
    <a-entity position="-35 19 -40">
      <a-entity gltf-model="#clouds" scale="2.2 2.2 2.2" rotation="0 45 0"></a-entity>
    </a-entity>
    <a-entity position="32 21 -38">
      <a-entity gltf-model="#clouds" scale="2.4 2.4 2.4" rotation="0 -45 0"></a-entity>
    </a-entity>

    <!-- Flores aleatorias en el suelo -->
    <a-entity id="flowers"></a-entity>
    <script>
      // Generar flores aleatorias
      const flowers = document.getElementById('flowers');
      for(let i = 0; i < 30; i++) {
        const x = (Math.random() - 0.5) * 80;
        const z = (Math.random() - 0.5) * 80 - 4;
        // Evitar √°rea de juego y caminos de spawn de minicubos
        if ((Math.abs(x) < 20 && z > -40 && z < 5) || // camino central
            (Math.abs(x - 15) < 10 && z > -40 && z < 5) || // camino derecho
            (Math.abs(x + 15) < 10 && z > -40 && z < 5)) continue; // camino izquierdo
        const flower = document.createElement('a-entity');
        flower.setAttribute('position', `${x} 0.1 ${z}`);
        const color = ['#FFB6C1', '#FF69B4', '#FFA07A', '#98FB98'][Math.floor(Math.random() * 4)];
        flower.innerHTML = `
          <a-cylinder color="#228B22" height="0.3" radius="0.02"></a-cylinder>
          <a-sphere position="0 0.3 0" color="${color}" radius="0.08"></a-sphere>
        `;
        flowers.appendChild(flower);
      }
    </script>

    <!-- Player invisible pero funcional para la l√≥gica del juego -->
    <a-entity id="player" position="0 1.5 -3">
      <a-sphere radius="0.1" visible="false"></a-sphere>
    </a-entity>

    <!-- C√°mara con movimiento suave -->
    <a-entity position="0 2.5 6">
      <a-camera wasd-controls="enabled: false"
                look-controls="smoothingFactor: 0.2"
                position="0 0 0"
                animation="property: position; from: 0 0 0; to: 0 0.05 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true">
      </a-camera>
    </a-entity>
  </a-scene>

  <!-- Game Over Menu -->
  <div id="game-over-overlay"></div>
  <div id="game-over-menu">
    <img src="/static/sprites/img/image.png" alt="Game Over" class="game-over-image">
    <h2>¬°Game Over!</h2>
    <div class="score">Puntuaci√≥n final: <span id="final-score">0</span></div>
    <div class="buttons">
      <button onclick="window.location.href='/'">Volver al Men√∫</button>
      <button onclick="window.location.reload()">Reintentar</button>
    </div>
  </div>

  <!-- Scripts del juego -->
  <script src="{{ url_for('static', filename='js/gestures.js') }}"></script>
  <script src="{{ url_for('static', filename='js/hud.js') }}"></script>
  <script src="{{ url_for('static', filename='js/enemies.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/assets-loader.js') }}"></script>

  <!-- Debug helper y animaciones -->
  <script>
    // Funci√≥n para mostrar combos
    function showCombo(count) {
      const popup = document.createElement('div');
      popup.className = 'combo-popup';
      popup.textContent = `¬°Combo x${count}! üî•`;
      document.body.appendChild(popup);
      setTimeout(() => popup.remove(), 800);
    }

    // Debug y verificaci√≥n A-Frame
    (function(){
      function logAndMark() {
        console.log('DEBUG - typeof AFRAME =', typeof window.AFRAME);
        const scene = document.querySelector('a-scene');
        console.log('DEBUG - a-scene element:', !!scene);
      }
      setTimeout(logAndMark, 300);
    })();
  </script>
</body>
</html>
